!function(e){var t,a=document;(t=function(e,n){e=t.element(e),t.on(e,"change",function(r){var o={jpg:/image\/jp(e?)g/i,png:/image\/png/i};n.format=n.format||["jpg","png"];for(var i=!1,s=0;s<n.format.length;s++)o[n.format[s]].test(e.files[0].type)&&(i=!0);if(!i)return e.value=null,void alert("The format is incorrect");var c=new FileReader,p=new Image,l=a.createElement("div"),d=a.createElement("canvas"),h=d.getContext("2d"),m=a.documentElement.clientWidth,g=a.documentElement.clientHeight,u="";c.readAsDataURL(e.files[0]),l.style.cssText="width:"+m+"px;height:"+g+"px;",l.className="cropper",m=m>640?640:m,d.width=n.size||m,d.height=n.size||m,d.className="cropper-canvas",u+='<div class="cropper-view" style="width:'+m+"px;height:"+m+"px;margin:-"+m/2+"px 0 0 -"+m/2+'px;"></div>',u+='<div class="cropper-btn"><a class="cropper-btn-cancel" href="javascript:void(0);">取消</a>',u+='<a class="cropper-btn-ok" href="javascript:void(0);">截取</a></div></div>',t.on(l,"touchstart touchmove touchend",function(e){e.preventDefault()}),c.onload=function(){p.src=c.result},p.onload=function(){function a(){w.className="cropper-container cropper-anime-middle",e.value=null,setTimeout(function(){t.element("body").removeChild(f)},350)}var r=p.width,o=p.height,i=(r>o?r/o:1)*m,s=r>o?(g-m)/2:0,v=r>o?m/o*-r/2+m/2:0;u='<div class="cropper-container cropper-anime-middle"><img class="cropper-img" src="'+c.result+'" width="'+i+'" style="top:'+s+"px;left:"+v+'px;" />'+u,l.innerHTML=u,t.element("body").appendChild(l);var f=t.element(".cropper"),w=t.element(".cropper-container"),y=t.element(".cropper-view"),b=t.element(".cropper-img"),x=t.element(".cropper-btn-cancel"),E=t.element(".cropper-btn-ok"),T=1,I=void 0,X=void 0,N=void 0,z=void 0,C=void 0,M=void 0,j=void 0,A=v,B=s;setTimeout(function(){w.className="cropper-container cropper-anime-middle translateY"},0),t.on(y,"touchstart touchmove touchend",function(e){var t=e.targetTouches[0],a=e.targetTouches[1],n=e.touches.length;if("touchstart"==e.type&&(2===n?(I=Math.abs(t.pageX-a.pageX),N=!1):1===n&&(z=t.pageX,M=t.pageY,N=!0)),"touchmove"==e.type&&(2===n?(X=T+(Math.abs(t.pageX-a.pageX)-I)/m,b.style.width=X*i+"px",N=!1):1===n&&(C=t.pageX-z,j=t.pageY-M,b.style.left=C+A+"px",b.style.top=j+B+"px",N=!0)),"touchend"==e.type){if(b.className="cropper-img cropper-anime",N){A=C+A,B=j+B;var r=-b.width+m;A=A>0?0:A<r?r:A;var o=(g-m)/2,s=g-(b.height+o);B=B>o?o:B<s?s:B,b.style.left=A+"px",b.style.top=B+"px"}else T=X>1?X:1,b.style.width=T*i+"px";setTimeout(function(){b.className="cropper-img"},200)}e.preventDefault()}),t.on(x,"touchend",a),t.on(E,"touchend",function(){if(Uint8Array&&atob&&Blob){var t=(n.size||m)/m;EXIF.getData(e.files[0],function(){EXIF.getAllTags(this);var e=EXIF.getTag(this,"Orientation"),i=A,s=B-(g-m)/2;if(""!=e&&1!=e)switch(e){case 6:h.rotate(90*Math.PI/180),s-=n.size||m;break;case 8:h.rotate(-90*Math.PI/180),i-=n.size||m;break;case 3:h.rotate(180*Math.PI/180),i-=n.size||m,s-=n.size||m}h.drawImage(p,0,0,r,o,i,s,b.width*t,b.height*t);var c=d.toDataURL();f.appendChild(d),c=c.split(",")[1],c=window.atob(c);for(var l=new Uint8Array(c.length),u=0;u<c.length;u++)l[u]=c.charCodeAt(u);n.success(new Blob([l],{type:"image/png"})),a()})}else alert("Your browser doesn't support it")})}})}).element=function(e){return/^\./.test(e)?1==(e=a.getElementsByClassName(e.substr(1))).length?e[0]:e:/^#/.test(e)?a.getElementById(e.substr(1)):1==(e=a.getElementsByTagName(e)).length?e[0]:e},t.on=function(e,t,a,n){t=t.split(" ");for(var r=0;r<t.length;r++)window.addEventListener?e.addEventListener(t[r],a,n||!1):e.attachEvent("on"+t[r],a)},e.cropper=t}(window);